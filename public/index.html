<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kamer Reservering</title>
    <link rel="stylesheet" href="style.css">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.14/index.global.min.js'></script>
    <link rel="icon" href="images/Logo.ico" type="image/x-icon">
    <link rel="shortcut icon" href="images/Logo.ico" type="image/x-icon">
</head>
<body>
    <div class="container">
        <img src="images/Logo.ico" alt="Logo" class="page-logo">
        <h1>Kamer Reservering</h1>
        <form id="reservation-form">
            <div class="form-group">
                <label for="contactperson">Contactpersoon (Voornaam):</label>
                <input type="text" id="contactperson" name="contactperson" required>
            </div>
            <div class="form-group">
                <label for="title">Titel:</label>
                <input type="text" id="title" name="title" required>
            </div>
            <div class="form-group">
                <label for="start-date">Startdatum (M,D,Y) en -tijd:</label>
                <input type="datetime-local" id="start-date" name="start-date" required>
            </div>
            <div class="form-group">
                <label for="end-date">Einddatum (M,D,Y) en -tijd:</label>
                <input type="datetime-local" id="end-date" name="end-date" required>
            </div>
            <div class="form-group">
                <label for="location">Locatie:</label>
                <select id="location" name="location" required>
                    <option value="De Peel 4p">De Peel 4p</option>
                    <option value="De Kasteeltuin 8p">De Kasteeltuin 8p</option>
                    <option value="Auditorium">Auditorium</option>
                    <option value="Huiskamer">Huiskamer</option>
                    <option value="De Windmolen 10p">De Windmolen 10p</option>
                </select>
            </div>
            <button type="submit">Reserveer</button>
        </form>
        <hr>
        <div id="calendar"></div>
        <!-- Robust Keycloak loader: try multiple CDNs and only load init after adapter is present -->
        <script>
        (function(){
            const urls = [
                'https://cdn.jsdelivr.net/npm/keycloak-js@26.2.0/dist/keycloak.min.js',
                'https://cdn.jsdelivr.net/npm/keycloak-js@latest/dist/keycloak.min.js',
                'https://unpkg.com/keycloak-js@latest/dist/keycloak.min.js'
            ];

            // Try to load the adapter from the list of URLs sequentially
            function loadAdapter(i){
                if(i>=urls.length){
                    console.error('Failed to load Keycloak adapter from CDNs. Please place a local copy at /vendor/keycloak.min.js and add it as a fallback.');
                    // Optionally try local vendor file if present
                    const local = '/vendor/keycloak.min.js';
                    const sLocal = document.createElement('script');
                    sLocal.src = local;
                    sLocal.onload = () => { console.log('Loaded local Keycloak adapter'); document.dispatchEvent(new Event('keycloak-adapter-loaded')); };
                    sLocal.onerror = () => console.error('Local fallback not found:', local);
                    document.head.appendChild(sLocal);
                    return;
                }

                const s = document.createElement('script');
                s.src = urls[i];
                s.async = false; // preserve execution order semantics
                s.onload = () => { console.log('Loaded Keycloak adapter from', urls[i]); document.dispatchEvent(new Event('keycloak-adapter-loaded')); };
                s.onerror = () => { console.warn('Failed to load Keycloak adapter from', urls[i]); loadAdapter(i+1); };
                document.head.appendChild(s);
            }

            loadAdapter(0);
        })();
        </script>

        <script>
        // Wait until adapter is ready, then load init and the rest of the app scripts
        document.addEventListener('keycloak-adapter-loaded', () => {
            const init = document.createElement('script');
            init.src = 'keycloak-init.js';
            init.defer = true;
            document.body.appendChild(init);

            const app = document.createElement('script');
            app.src = 'script.js';
            app.defer = true;
            document.body.appendChild(app);
        });
        </script>
</body>
</html>
